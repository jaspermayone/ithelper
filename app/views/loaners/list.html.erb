<div class="container-responsive px-3 pt-3">
  <div class="box">
    <div class="row mb-3">
      <div class="col">
        <h1 class="mb-0">Loaners</h1>
      </div>
      <div class="col-auto">
        <div class="form-group mb-0">
          <label for="status-filter" class="mr-2">Filter by Status:</label>
          <%= select_tag 'status-filter', options_for_select(['All', 'Available', 'Loaned', 'Disabled', 'Maintenance'], 'All'), class: 'form-control' %>
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table is-bordered is-hoverable" id="loaners-table">
        <thead>
          <tr>
            <th class="id-col">ID</th>
            <th class="status-col">Status</th>
            <th class="asset-tag-col">Asset Tag</th>
            <th class="serial-num-col">Serial Number</th>
            <th class="loan-count-col">Loan Count</th>
            <th class="actions-col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @loaners.each do |loaner| %>
            <% row_class = case loaner.status.downcase
                          when 'available' then 'available'
                          when 'loaned' then 'loaned'
                          when 'disabled' then 'disabled'
                          when 'maintenance' then 'maintenance'
                          else ''
                          end %>
            <tr class="<%= row_class %>">
              <td><%= loaner.loaner_id %></td>
              <td><%= loaner.status.capitalize %></td>
              <td><%= loaner.asset_tag %></td>
              <td><%= loaner.serial_number %></td>
              <td><%= loaner.loan_count %></td>
              <td>
                <% if loaner.available? %>
                  <%= link_to "Loan Device", checkout_loan_path(loaner), class: "btn btn-primary btn-sm", target: "_blank" %>
                  <%= link_to "Mark Broken", broken_loaner_path(loaner),  class: "btn btn-danger btn-sm" %>
                <% elsif loaner.loaned? %>
                  <%= link_to "Check In", return_loaner_path(loaner), class: "btn btn-success btn-sm" %>
                <% elsif loaner.disabled? %>
                  <%= link_to "Enable Device", enable_loaner_path(loaner), class: "btn btn-success btn-sm" %>
                <% elsif loaner.maintenance? %>
                  <%= link_to "Repair", repair_loaner_path(loaner), class: "btn btn-success btn-sm" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
  .table-responsive {
    height: 75vh;
    overflow-y: auto;
  }

  .table thead th {
    position: sticky;
    top: 0;
    z-index: 1;
    background: white; /* or another background color */
  }

  .id-col {
    width: 50px; /* Adjust the width as needed */
  }

  .status-col {
    width: 100px; /* Adjust the width as needed */
  }

  .asset-tag-col {
    width: 120px; /* Adjust the width as needed */
  }

  .serial-num-col {
    width: 100px; /* Adjust the width as needed */
  }

  .loan-count-col {
    width: 120px; /* Adjust the width as needed */
  }

  .actions-col {
  }

  /* Define your status colors here as needed */
  .available {
    background-color: #d4edda; /* Light green */
  }

  .loaned {
    background-color: #fff3cd; /* Light yellow */
  }

  .disabled {
    background-color: #f8d7da; /* Light red */
  }

  .maintenance {
    background-color: #cce5ff; /* Light blue */
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const filterSelect = document.getElementById('status-filter');
    const rows = document.querySelectorAll('#loaners-table tbody tr');

    filterSelect.addEventListener('change', function() {
      const selectedStatus = filterSelect.value.toLowerCase();

      rows.forEach(row => {
        const status = row.classList.contains(selectedStatus); // Check if row has the status class
        if (selectedStatus === 'all' || status) {
          row.style.display = ''; // Show the row
        } else {
          row.style.display = 'none'; // Hide the row
        }
      });
    });

    // Function to apply status-based coloring (if needed initially)
    function applyStatusColors() {
      rows.forEach(row => {
        const status = row.classList[0]; // Get the first class which represents status
        row.classList.remove('available', 'loaned', 'disabled', 'maintenance'); // Remove all status classes
        row.classList.add(status); // Add the current status class
      });
    }

    // Initial call to apply status colors on page load (optional if rows already have classes)
    applyStatusColors();
  });
</script>
